# 基于视觉的无人机自主着降系统 - 开发指南

## 1. 项目概述

本项目旨在复现一个基于视觉的无人机自主着降系统。任务核心是利用机载电脑（树莓派）处理下视摄像头图像，识别地面靶标，并通过 MAVLink 协议控制 PX4 飞控，实现无人机的自主搜索与精准降落。

系统逻辑闭环：
视觉感知 $\rightarrow$ 误差解算 $\rightarrow$ 控制算法 $\rightarrow$ 运动执行

## 2. 硬件平台与环境搭建

### 2.1 树莓派基础配置

- 供电要求：必须保证 5V 3A 的稳定供电，防止因电压波动导致系统重启。

- 操作系统：建议安装 Ubuntu 20.04。

- 网络与通信：

    - 配置 SSH 服务，确保可进行远程调试。

    - 配置 WiFi 自动连接热点。

- 基础工具：安装 git, vim/nano 等常用工具。
- 掌握 Linux 基础命令，学会监控树莓派状态。

### 2.2 开发环境依赖

请自行配置 Python 3 开发环境，并安装以下核心库：

- OpenCV：用于图像处理。

- NumPy：用于科学计算与矩阵操作。

- DroneKit 或 PyMAVLink：用于与飞控进行 MAVLink 通信。

### 2.3 硬件连接

- 飞控连接：使用 USB 线或 GPIO 串口连接树莓派与飞控（通常设备号为 /dev/ttyACM0 或 /dev/ttyAMA0）。需检查串口读写权限。

- 视觉传感器：连接 USB 免驱摄像头，确保系统能正确挂载设备（如 /dev/video0）。

## 3. 视觉感知系统

本模块的目标是稳定、实时地识别地面靶标，并输出其在图像中的位置。

### 3.1 相机选型

选择无畸变或畸变较小的镜头。

视场角需适中：太大导致高处目标太小，太小导致低空容易丢失目标。

### 3.2 算法实现流程

以下是一个基础的视觉识别方案，流程如下，仅供参考：

- 色彩空间转换



- 图像预处理：

    - 二值化

    - 形态学操作

- 特征提取：

    - 查找图像轮廓

    - 筛选机制

- 位置解算

- 误差计算

## 4. 飞行控制系统

本模块负责将视觉系统输出的像素误差转化为无人机的速度控制指令。

### 4.1 通信与模式

建立与飞控的稳定连接。

安全逻辑：程序必须持续监控飞控模式。仅在 GUIDED 模式下，才允许发送速度控制指令；一旦切出该模式，程序应立即停止控制。

### 4.2 坐标系转换 (关键)

必须严格区分图像坐标系与机体坐标系，并进行正确映射，否则会导致控制发散。

- 图像坐标系

- 机体坐标系

控制映射：

图像 * 轴误差 $\rightarrow$ 控制机体 * 轴速度 。


### 4.3 控制算法设计

推荐采用 PID 控制器，具体选择几项请自行调试：


注意：微分项对噪声敏感，建议对 D 项进行处理，自行思考。

### 4.4 状态机逻辑

程序主循环应包含清晰的状态流转：

搜索：未检测到目标时，保持悬停或执行搜索策略。

跟踪：检测到目标，运行控制算法调整水平位置。

判定：判断是否满足降落条件。

降落：满足条件后，发送降落指令。

## 5. 安全作业规范

安全是无人机实验的首要前提。

### 5.1 操作规范

充电安全：严格执行“人走电断”，禁止无人看管充电。

上电流程：先检查接线 $\rightarrow$ 接通机载电脑 $\rightarrow$ 确认无误 $\rightarrow$ 接通动力电池。

断电流程：先断开动力电池 $\rightarrow$ 后断开机载电脑/外设。

### 5.2 调试与飞行

地面测试 (无桨)：在安装螺旋桨前，必须先在地面运行代码。手持无人机移动，观察终端输出的速度指令方向是否与位移方向相反（即产生抵抗运动的效果）。

- 紧急避险：

    - 实验过程中，遥控器必须时刻由安全员掌握。

    - 程序出现异常或飞机姿态不可控时，立即通过遥控器切回 STABILIZE 或 POSHOLD 模式接管。

    - 代码需包含异常处理，确保程序中断时能发送零速度指令。